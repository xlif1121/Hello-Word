<!--Borrowed and modified from Lab 14 and Assignment1, modified template from ww3schools.com-->
<script>
    var products = 
[
{  
"name":"Adidas Yeezy Boost 350 V2 Synth (Reflective)",  
"price": 863.00,  
"image": "img01.jpg"
},
{  
"name":"Adidas Yeezy 450 Cloud White",  
"price": 415.00,  
"image": "img02.jpg"
},
{  
    "name":"Nike MAG Back to the Future (2016)",  
    "price": 50000.00,  
    "image": "img03.jpg"
    },
    {  
        "name":"Jordan 1 Retro High Dior",  
        "price": 7114.00,  
        "image": "img04.jpg"
        },
        {  
            "name":"Jordan 1 Retro High Off-White University Blue",  
            "price": 2095.00,  
            "image": "img05.jpg"
            }
];

</script>

<script>
function isNonNegInt(q, return_errors = false) { // Checks to see if the inputted values are either positive, an integer, or a whole value
    errors = []; // Assume there are no errors AT FIRST
    if (q == '') q = 0; // Sets blank inputs to the quantity of 0 
    if (Number(q) != q) errors.push('<font color="red">Not a number!</font>'); // Check if the string is a number value
    else if (q < 0) errors.push('<font color="red">Negative value!</font>'); // Check if the string is non-negative
    else if (parseInt(q) != q) errors.push('<font color="red">Not a full value!</font>'); 
    // Check that it is an integer
    return return_errors ? errors : (errors.length == 0);
}
function checkQuantityTextbox(theTextbox) { // Utilizes NonNegInt to double check quantity
    errs = isNonNegInt(theTextbox.value, true);
    if (errs.length == 0) errs = ['You want:']; // Adjusts to quantity that the user wants
    if (theTextbox.value.trim() == '') errs = ['Quantity'];
    document.getElementById(theTextbox.name + '_label').innerHTML = errs.join(", ");
}
// NOTE: Made changes on the server so that the user is redirected to login.html after selecting quantities
window.onload = function () {
    let params = (new URL(document.location)).searchParams; // GET the query string & check that the quantities are valid values then go to login.html if it is good
    if (params.has('submitPurchase')) {
        has_errors = false; // Assume quantities are valid from the start
        total_qty = 0; // Check if a value was selected i.e total quantity > 0 
    // Display each products' image, name, and price
    for (i = 0; i < products.length; i++) {
        if (params.has(`quantity${i}`)) {
            a_qty = params.get(`quantity${i}`);
            product_display[`quantity${i}`].value = a_qty; // Put data back in textbox, make sticky
            total_qty += a_qty;
    if (!isNonNegInt(a_qty)) {
        has_errors = true; // IF there are invalid quantities
        checkQuantityTextbox(product_display[`quantity${i}`]); // Displays error's location
    }
}
    }
}
}

</script>

</script>
<!DOCTYPE html>
<html>

<head>
    <meta Xinfei="utf-8">
    <title>Xinfei's Footwear Store</title>

    <link href="https://fonts.googleapis.com/css?family=Cherry+Swash|Raleway" rel="stylesheet">

    <link href="Products-style.css" rel="stylesheet">
</head>

<body>

    <header>
        <h1>Xinfei's Footwear Store</h1>
    </header>
    <form action="./Invoice.html" method="POST">
    <form action="./login.html" method="POST"></form>
        <div>
                <main>
    <script>
        subtotal=0;
        for (i=0; i< products.length; i++) {
    document.write(`
    <section class="item">
                       <h2>${products[i].name}</h2>
                        <p>${products[i].price}</p>
                        <lable>Quantity:</lable>
                            <input type="text" placeholder="0" name="quantity${i}">
                        <img src="./images/${products[i].image}">
                    </section>
    `);
        }
         
    </script>
                </main>
            </div>

            <div>
                <script>
                document.write(`<center><a href="Invoice.html${location.search}"><button>Place Order</button></center></a>`)
            </script>

            <div>
                <script>
                document.write(`<center><a href="login.html${location.search}"><button>Sign In</button></center></a>`)
            </script>
    
        </body>
        
        </html>